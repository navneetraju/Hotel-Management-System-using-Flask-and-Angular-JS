<!DOCTYPE html>
<html lang="en" ng-app="notesApp">
<head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">

        <title>Add Employee</title>
        <link rel="icon" href="web-icon/favicon.ico" type="image/icon type">
         <!-- Bootstrap core CSS -->
         <link href="https://getbootstrap.com/docs/4.4/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
         <link href="https://getbootstrap.com/docs/4.4/dist/css/bootstrap.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <!-- Custom styles for this template -->
        <link href="dash.css" rel="stylesheet">
        <style>
            .modal-backdrop {
                /* bug fix - no overlay */    
                display: none;    
            }
        </style>
</head>

<body ng-controller="MainCtrl as ctrl">
    <nav class="navbar navbar-dark fixed-top bg-dark flex-md-nowrap p-0 shadow">
            <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="main_page.html">Sunrise Hotels</a>
            <ul class="navbar-nav px-3">
                <li class="nav-item text-nowrap">
                    <a class="nav-link" href="#">Sign out</a>
                </li>
            </ul>
        </nav>
    <div class="container-fluid">
        <div class="row">
            <nav class="col-md-2 d-none d-md-block bg-light sidebar">
                <div class="sidebar-sticky">
                    <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="dashboard.php">
                        <span data-feather="home"></span>
                        Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="roomreservation.php">
                        <span data-feather="plus-square"></span>
                        Room Reservation
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="custroom.html">
                        <span data-feather="activity"></span>
                            On-Going Room Service
                        </a>
                    </li>
                </ul>
                <hr/>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="employee_add.html">
                        <span data-feather="user-plus"></span>
                            Add Employee
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="cur_employees.html">
                        <span data-feather="users"></span>
                            View Current Employees
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="employee_delete.html">
                        <span data-feather="user-minus"></span>
                            Remove Employees
                        </a>
                    </li>
                </ul>
                <hr/>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="stats.php">
                        <span data-feather="bar-chart-2"></span>
                            View Stats
                        </a>
                    </li>
                </ul>
                </div>
            </nav>
        </div>
    </div>
    
    <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
        <br/>  
    <div class="page-header">
        <h3>Add Employee</h3>
    </div>
    <hr/>
    <br/>
        <div class="row">
            <div class="col-md-3">
        <form>
            <div class="form-group">
            <input type="text" class="form-control" name="emp_id" id="emp_id" placeholder="Enter Employee ID to Delete">
            </div>
        </form>
            </div>
            <button class="btn btn-primary" onclick="submit()" style="height:100%;">Search</button>
        <table class="table table-striped table-hover" id="tabl" style="visibility: hidden;width:100%;">
            <thead class="thead-dark">
              <tr>
                <th>EMPLOYEE ID</th>
                <th>FIRST NAME</th>
                <th>MIDDLE NAME</th>
                <th>LAST NAME</th>
                <th>DATE OF BIRTH</th>
                <th>PHONE NUMBER</th>
                <th>GENDER</th>
                <th>JOIN_DATE</th>
                <th>SALARY</th>
              </tr>
            </thead>
            <tbody id="myTable" >
              <tr ng-repeat="item in myobj">
                  <td>{{item.EMP_ID}}</td>
                  <td>{{item.FNAME}}</td>
                  <td>{{item.MINIT}}</td>
                  <td>{{item.LNAME}}</td>
                  <td>{{item.DOB.slice(5,item.CHECKIN_DATE.length-12)}}</td>
                  <td>{{item.PHONE}}</td>
                  <td>{{item.GENDER}}</td>
                  <td>{{item.JOIN_DATE.slice(5,item.CHECKIN_DATE.length-12)}}</td>
                  <td>{{item.SALARY}}</td>
              </tr>
            </tbody>
      </table>
      
    </div>
    

    </div>

    <button class="btn btn-primary" id="hiddenbtn" style="visibility: hidden;" onclick="deleteEmp();">Delete this employee</button>
    </main>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
      <script>window.jQuery || document.write('<script src="https://getbootstrap.com/docs/4.4/assets/js/vendor/jquery.slim.min.js"><\/script>')</script><script src="https://getbootstrap.com//docs/4.4/dist/js/bootstrap.bundle.min.js" integrity="sha384-6khuMg9gaYr5AxOqhkVIODVIvm9ynTT5J4V1cfthmT+emCG6yVmEZsRHdxlotUnm" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.9.0/feather.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
        <script src="dashboard.js"></script></body>
        <script
        src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.19/angular.js"></script>
        <script>
            const wait=ms=>new Promise(resolve => setTimeout(resolve, ms)); 
            function submit(){
                //console.log('inside_func');
                console.log(emp_id.value);
                toSend=Object();
                toSend['emp_id']=emp_id.value;
                formData = JSON.stringify(toSend);
                xhr=new XMLHttpRequest();
                var url='http://localhost:5000/wt2/employees/get_emp ';
                xhr.open("POST",url);
                xhr.setRequestHeader("Content-type","application/json");
                xhr.onreadystatechange=reportfunc;
                xhr.send(formData);
            }
            function reportfunc()
            {
                if(this.readyState==4 && this.status==200)
                {
                    myobj=JSON.parse(xhr.response);
                    window.myobj=myobj;
                    //console.log(window.myobj);
                    document.getElementById("tabl").style.visibility="visible";
                    document.getElementById("hiddenbtn").style.visibility="visible";
                }

            }
            function deleteEmp(){
                    //console.log(toSend);
                    xhr=new XMLHttpRequest();
                    var url='http://localhost:5000/wt2/employees/del_emp';
                    xhr.open("POST",url);
                    xhr.setRequestHeader("Content-type","application/json");
                    xhr.onreadystatechange=report;
                    xhr.send(formData);
            }
            function report(){
                if(this.readyState==4 && this.status==200)
                {
                    document.getElementById('mt').innerHTML="Employee Deleted Successfully!";
                    document.getElementById('mt').style.color="green";
                    document.getElementById('mb').innerHTML="Close this dialog to proceed";
                    //document.getElementById("myModal").style.zIndex=-1;
                    $("#myModal").modal();
                    
                }
                else{
                    document.getElementById('mt').innerHTML="Employee Was Not Deleted!";
                    document.getElementById('mt').style.color="red";
                    //document.getElementById('mb').innerHTML="Close this dialog and try again!";
                    $("#myModal").modal();
                }
            }
            angular.module("notesApp",[])
                .controller('MainCtrl',["$scope",function($scope){
                    //console.log('here');
                    $scope.$apply();
                    wait(0.5*1000).then(() => $scope.myobj=window.myobj);
                    wait(0.5*1000).then(()=>$scope.$apply());
                    wait(0.5*1000).then(()=>console.log($scope.myobj[0].CATEGORY));
                    setInterval(function(){submit();wait(1*1000).then(() => $scope.myobj=window.myobj);wait(1*1000).then(()=>$scope.$apply());wait(1*1000).then(()=>console.log("updated"));}, 1000);
                    //console.log(window.myobj);
                    //console.log(glo);
                }]);
        </script>    
            <div class="modal" id="myModal">
                <div class="modal-dialog">
                <div class="modal-content">
                
                    <!-- Modal Header -->
                    <div class="modal-header">
                    <h4 class="modal-title" id="mt">Modal Heading</h4>
                    <button type="button" class="close" data-dismiss="modal">×</button>
                    </div>
                    
                    <!-- Modal body -->
                    <div class="modal-body" id="mb">
                    Modal body..
                    </div>
                    
                    <!-- Modal footer -->
                    <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                    </div>
                    
                </div>
                </div>
            </div>     
</body>
</html>